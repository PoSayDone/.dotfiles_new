#!/usr/bin/env bash

## Copyright (C) 2020-2021 Aditya Shakya <adi1090x@gmail.com>
## Everyone is permitted to copy and distribute copies of this file under GNU-GPL3

## A script to get colours from xrdb & deploy it to polybar, alacritty & rofi.

DIR="$HOME/.config/bspwm"

getcolors () {
	FOREGROUND="#fffaff"
	BACKGROUND="#0A0E11"
	CURSOR="$(xrdb -query | grep 'cursorColor:'| awk '{print $NF}')"
	BLACK="#0A0E11"
	RED="#92A7CF"
	GREEN="#6B89B6"
	YELLOW="#959DB2"
	BLUE="#5E81B4"
	MAGENTA="#A1AFD0"
	CYAN="#7594C5"
	WHITE="#dcd4da"
	ALTBLACK="#1c2731"
	ALTRED="#a6d1ff"
	ALTGREEN="#78aeff"
	ALTYELLOW="#acc2fc"
	ALTBLUE="#68a4fb"
	ALTMAGENTA="#b9d9ff"
	ALTCYAN="#83bbff"
	ALTWHITE="#fffaff"
}

bspbar () {
	cat > $DIR/polybar/colors <<- EOF
	[colors]

	foreground = ${FOREGROUND}
	background = #B30A0E11
  active = #7485a5
  inactive = #505b71
	black = ${BLACK}
	red = ${RED}
	green = ${GREEN}
	yellow = ${YELLOW}
	blue = ${BLUE}
	magenta = ${MAGENTA}
	cyan = ${CYAN}
	white = ${WHITE}
	altblack = ${ALTBLACK}
	altred = ${ALTRED}
	altgreen = ${ALTGREEN}
	altyellow = ${ALTYELLOW}
	altblue = ${ALTBLUE}
	altmagenta = ${ALTMAGENTA}
	altcyan = ${ALTCYAN}
	altwhite = ${ALTWHITE}
	EOF
}

bsplock () {
	cat > $DIR/i3lock/colors <<- EOF

  BLANK='#00000000'
  CLEAR='#ffffff22'
  DEFAULT='#ff00ffcc'
  TEXT='${ALTWHITE}'
  WRONG='${RED}'
  VERIFYING='${BLUE}'
	EOF
}

bspeww () {
	cat > $DIR/eww/_colors.scss <<- EOF
  \$bg: rgba(\$color: ${BACKGROUND}, \$alpha: 0.4);;
  \$contrastbg: ${BACKGROUND};
  \$bgSecondary: ${BACKGROUND};
  \$bgCal: rgba(\$color: ${BACKGROUND}, \$alpha: 0.6);
  \$fg: ${ALTWHITE};
  \$fgDim: ${ALTWHITE};
  \$watermelon: #e05f65;

  // Aliases
  \$background: \$bg;
  \$backgroundSecondary: \$bgSecondary;
  \$foreground: \$fg;
  \$foregroundDim: \$fgDim;

  \$black: #242931;
  \$red: ${RED};
  \$green: ${BLUE};
  \$blue: ${ALTRED};
  \$cyan: ${ALTBLUE};
  \$blue-desaturated: #74bee9;
  \$magenta: #c68aee;
  \$purple: #c68aee;
  \$aquamarine: #94f7c5;
  \$yellow: #f1cf8a;
  \$accent: \$red;
  \$javacafeMagenta: #c68aee;
  \$javacafeBlue: #70a5eb;
	EOF
}

bspterm () {
	cat > "$DIR"/alacritty/colors.yml <<- _EOF_
		## Colors configuration
		colors:
		  # Default colors
		  primary:
		    background: '${BACKGROUND}'
		    foreground: '${FOREGROUND}'

		  # Normal colors
		  normal:
		    black:   '${BLACK}'
		    red:     '${RED}'
		    green:   '${GREEN}'
		    yellow:  '${YELLOW}'
		    blue:    '${BLUE}'
		    magenta: '${MAGENTA}'
		    cyan:    '${CYAN}'
		    white:   '${WHITE}'

		  # Bright colors
		  bright:
		    black:   '${ALTBLACK}'
		    red:     '${ALTRED}'
		    green:   '${ALTGREEN}'
		    yellow:  '${ALTYELLOW}'
		    blue:    '${ALTBLUE}'
		    magenta: '${ALTMAGENTA}'
		    cyan:    '${ALTCYAN}'
		    white:   '${ALTWHITE}'
	_EOF_
}

#code-transparent needed
bspvscode () {
	sed -i 's/\("workbench\.background"\s*:\s*\).*$/\1"#0A0E11B3",/' "$HOME/.config/Code - OSS/User/settings.json" &
}

bsprofi () {
	cat > $DIR/rofi/themes/colors.rasi <<- EOF	
	* {
		background:			#0A0E11B3;
		backgroundSolid:			#0A0E11;
		backgroundAdditional:			#0A0E1166;
    background-alt: #00000000;
		foreground:			${FOREGROUND};
		foreground-alt:			${ALTWHITE};
		selected:			${RED};
		highlight:			${YELLOW};
		urgent:				${BLUE};
		on:					${GREEN};
		off:				${RED};
	}
	EOF
}

bspdunst () {
	sed -i '/urgency_low/Q' "$HOME"/.config/bspwm/dunst/dunstrc
	cat >> "$HOME"/.config/bspwm/dunst/dunstrc <<- _EOF_
		[urgency_low]
		timeout = 2
    background = "${BACKGROUND}B3"
    foreground = "${FOREGROUND}"
		frame_color = "${BLUE}"

		[urgency_normal]
		timeout = 5
    background = "${BACKGROUND}B3"
    foreground = "${FOREGROUND}"
		frame_color = "${BLUE}"

		[urgency_critical]
		timeout = 0
    background = "${BACKGROUND}B3"
    foreground = "${FOREGROUND}"
		frame_color = "${RED}"
	_EOF_
}

#colors for firefox
bspcss () {
	cat > $DIR/css/colors.css <<- EOF	
	:root {
		--bg-color: #0A0E11B3;
	}
	EOF
}

#needed pywal-discord (yay -S pywal-discord)
bspapps () {
  exec python3 $DIR/scripts/wal-telegram/pallete-gen.py &
  exec pywal-discord &
  exec spicetify update &
  exec spicetifyreload &
  exec zathura-pywal -a 0.7 &
  exec qutebrowser :config-source &
}

bspstartpage () {
	cat > $DIR/startpage/css/colors.css <<- EOF	
	:root {
          --bg-color: ${BACKGROUND}b3;
          --bg-color_solid: ${BACKGROUND};
          --text-color: ${RED};
	}
	EOF
}

bspnvim () {
  sed -i "s/systemAccent.*/systemAccent = { fg = \"${YELLOW}\" }\,/" "$HOME/.config/bspwm/nvchad/custom/highlights.lua"
}

# bspspoti () {
# 	cat > $DIR/spicetify/ziro/color.ini <<- EOF	
#   [blue-dark]
#   text               = fffaff
#   subtext            = fffaff
#   main               = 0A0E11
#   sidebar            = 0A0E11
#   player             = 0A0E11
#   card               = 1c2731
#   shadow             = 0A0E11
#   selected-row       = 92A7CF
#   button             = 92A7CF
#   button-active      = 92A7CF
#   button-disabled    = 92A7CF
#   tab-active         = a6d1ff
#   notification       = 171d20
#   notification-error = fb7c7c
#   misc               = 1e2529
# 	EOF
# }

main () {
	getcolors
  bspeww
  bsplock
	bspterm
	bsprofi
	bspdunst
  bspvscode
  # bspspoti
  bspstartpage
  bspnvim
  bspapps
}

main
